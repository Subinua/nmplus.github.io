## HK 재구축 사업
### 작성일 : 2021.03.23


**환경**
1. ASIS환경은 리눅스에 c언어로 구성
2. TOBE환경
    - 중계 솔루션
    - 솔루션은 이클립스 IDE Tool을 이용하여 개발된 제품
    - 운영환경은 이중화로 관리
    - DB에 로그가 적재됨(ASIS는 FILE로 관리)

**개발기간**
- 2022.07 (8개월)
- 업체와 MOU로 투입

**구성원**
총 9명

**개발 내용**
- 대외계 업무는 외부기관과 내부 기간계의 중간연결 통로로 인터페이스되는 전문을 주고 받는 중계서버이다.<br/>
  은행, 증권사, 공공기관등을 VPN장비, 방화벽등 네트워크 구간이 문제없이 연결될경우 마지막 APPLICATION 구간을<br/>
  솔루션에서 폴링, 채널연결 설정 등으로 세션을 유지 및 대기해서 요청전문, 응답전문이 문제없이 주고받도록 하는 업무이다.
  
- 기존 ASIS는 C언어 기반으로 파일로 로그관리가 되었으며 리눅스의 grep 명령어 등을 통해 송/수신의 상태 문제점을 파악하고 있었음.

- 솔루션으로 개발
  - java기반으로된 솔루션으로 툴에서 채널설정(ip/port 등), 전문등록, 프로세스(전문 조건설정 등)설정, 거래로그확인 등<br/>
   각 기관의 업무마다 하나씩 설정을 추가하는 방식으로 개발하며 여러개발자가 동일한 프로세스를 수정할 경우 설정이 override될 수 있었음.<br/>
   설정들은 각각 파일로 관리되며 화면을 호출시 파일을 읽어 설정을 툴에 보여주는 방식이다. 형상관리 툴을 사용할 수 없는 구조로<br/>
   여러사람이 작업할 경우 소통이 필요했다.
  - tcp/ip, x.25, http등 여러 방식을 지원하며 server/client를 채널 설정등 간단한 설정으로 구현이 가능했으나<br/>
   여러 상황을 커버할 수 있도록 설정이 있지만 주석으로 달려있는 설명으로는 어떤 이야기를 하는 것인지 알기가 어려웠으며<br/>
   로그에 출력되는 부분도 어떤 의미를 갖는지 직관적이지 않아 오류를 파악하기란 큰 숙제였다.
  - 모든설정은 파일로 관리되며 솔루션 서버가 기동중에도 설정변경 후 적용시 해당시점부터 hotDeploy로 바로 적용이되어<br/>
    재기동을 하지 않아도 되는 장점이 있지만 설정은 되었지만 적용이 안되는 경우도 발생하기도 했다.(연구소 문의..)
   
- 라우팅 솔루션사용
  - 개발기간에 ip/port의 변경 작업도 진행되어야 해서 라우팅솔루션을 사용하였음.
  - 라우팅솔루션은 기존에 사용하는 ip/port를 내부에서 사용하는 ip/port로 연결 해주는 역할을 하며 vpn, 방화벽이 작업되는 동안<br/>
    ASIS에서 사용된 ip/port를 TOBE서버에서 사용할 수 있도록 역할을 담당했다.
  - 솔루션에서 설정된 기존ip와 신규ip를 체크박스를 통해 hotDeploy가 가능했기 때문에 운영 ip전환 작업시 전환/롤백이 1분이내로 작업이 가능했음.

  - IP/PORT 설정후 기관과의 세션상태를 수시로 확인해야 해서 터미널에서 NETSTAT명령어를 통해 estableshed상태여부를 확인했다.
    + shell스크립트를 사용해 1초마다 연결 정보를 체크하도록 하는 샘플
  ```
  while true
  do
  date
  sleep 1
  netstat -an | grep '아이피 또는 포트정보'
  done
  ```

- ip전환시 공공기관이나 은행은 공문을 발송하여 일정 수립 및 작업을 진행했으며 네트워크작업(방화벽, VPN등)이 원활하지 않아<br/>
  대외계에서 확인하기까지 쉽지가 않았다. 네트워크 구간의 확인은 프로젝트에 대한 지원은 좋지 못했다.<br/>
  간단한 확인작업도 절차를 밟아야 했기에 ip전환작업은 오래 걸렸으며 철수할때까지 끝내지 못했다.

- ASIS에서 사용했던 3개월 동안의 전문로그를 분석하여 각기관별 사용된 전문을 찾아낸 후 TOBE에 설정 및 전문추가 작업이 대외계 재구축의 개발범위로 설정까지는<br/>
  3개월 내에 끝났으며 나머지는 예외상황 처리 및 오류수정 등 테스트기간이 길었다.


**마치며**

네트워크관련 지식을 쌓을수 있는 기회였으며 대외계 업무는 보험회사의 업무를 몰라도 프로젝트를 진행하는데 큰문제가 되진 않았으며<br/>
인터페이스가 해당기관의 업무에 특화된 경우는 업무 파악이 필요 한 부분도 있었다.<br/>
솔루션을 다른 프로젝트에 도입한다면 업체와 협업을 하지 않는다면 현업의 요건에 맞게 개발하기는 쉽지않아 보인다.


